name: Monthly Benchmark Publication Reminder

on:
  schedule:
    - cron: "0 14 1 * *"
  workflow_dispatch:

permissions:
  issues: write

jobs:
  reminder:
    runs-on: ubuntu-latest
    steps:
      - name: Create monthly publication reminder issue
        uses: actions/github-script@v7
        with:
          script: |
            const now = new Date();
            const ym = `${now.getUTCFullYear()}-${String(now.getUTCMonth() + 1).padStart(2, "0")}`;
            const title = `Monthly benchmark publication reminder (${ym})`;
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const { data: issues } = await github.rest.issues.listForRepo({
              owner,
              repo,
              state: "open",
              per_page: 100,
            });
            if (issues.some((i) => i.title === title)) {
              core.info(`Issue already exists: ${title}`);
              return;
            }
            await github.rest.issues.create({
              owner,
              repo,
              title,
              body: [
                "Use `docs/publication-cadence.md` checklist for this month's benchmark publication.",
                "",
                "Required:",
                "- validate matrix/results",
                "- parser tests",
                "- ecosystem snapshot refresh",
                "- commit artifacts with publication date",
              ].join("\n"),
              labels: ["documentation"],
            });
